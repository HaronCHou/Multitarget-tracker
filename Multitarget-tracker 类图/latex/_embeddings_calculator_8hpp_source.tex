\hypertarget{_embeddings_calculator_8hpp_source}{}\doxysection{Embeddings\+Calculator.\+hpp}
\label{_embeddings_calculator_8hpp_source}\index{D:/zhr\_files/Multitarget-\/tracker-\/master/src/Tracker/EmbeddingsCalculator.hpp@{D:/zhr\_files/Multitarget-\/tracker-\/master/src/Tracker/EmbeddingsCalculator.hpp}}
\mbox{\hyperlink{_embeddings_calculator_8hpp}{浏览该文件的文档.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{preprocessor}{\#pragma once}}
\DoxyCodeLine{2 }
\DoxyCodeLine{6 \textcolor{keyword}{class }\mbox{\hyperlink{class_embeddings_calculator}{EmbeddingsCalculator}}}
\DoxyCodeLine{7 \{}
\DoxyCodeLine{8 \textcolor{keyword}{public}:}
\DoxyCodeLine{9     \mbox{\hyperlink{class_embeddings_calculator_acc38f77c11d5dee94de6ef8441cc9b93}{EmbeddingsCalculator}}() = \textcolor{keywordflow}{default};}
\DoxyCodeLine{10     \textcolor{keyword}{virtual} \mbox{\hyperlink{class_embeddings_calculator_af048c897014809dae64ad42452c3f18e}{\string~EmbeddingsCalculator}}() = \textcolor{keywordflow}{default};}
\DoxyCodeLine{11 }
\DoxyCodeLine{13     \textcolor{keywordtype}{bool} \mbox{\hyperlink{class_embeddings_calculator_a2abea9d418edfac4babe84e40870ba88}{Initialize}}(\textcolor{keyword}{const} std::string\& cfgName, \textcolor{keyword}{const} std::string\& weightsName, \textcolor{keyword}{const} cv::Size\& inputLayer)}
\DoxyCodeLine{14     \{}
\DoxyCodeLine{15 \textcolor{preprocessor}{\#ifdef USE\_OCV\_EMBEDDINGS}}
\DoxyCodeLine{16         m\_inputLayer = inputLayer;}
\DoxyCodeLine{17 }
\DoxyCodeLine{18 \textcolor{preprocessor}{\#if 1}}
\DoxyCodeLine{19         m\_net = cv::dnn::readNet(weightsName, cfgName);}
\DoxyCodeLine{20 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{21         m\_net = cv::dnn::readNetFromTensorflow(weightsName, cfgName);}
\DoxyCodeLine{22 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{23         \textcolor{keywordflow}{if} (!m\_net.empty())}
\DoxyCodeLine{24         \{}
\DoxyCodeLine{25             m\_net.setPreferableBackend(cv::dnn::DNN\_BACKEND\_INFERENCE\_ENGINE);}
\DoxyCodeLine{26             m\_net.setPreferableTarget(cv::dnn::DNN\_TARGET\_CPU);}
\DoxyCodeLine{27         \}}
\DoxyCodeLine{28         \textcolor{keywordflow}{return} !m\_net.empty();}
\DoxyCodeLine{29 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{30         std::cerr << \textcolor{stringliteral}{"{}EmbeddingsCalculator was disabled in CMAKE! Check SetDistances params."{}} << std::endl;}
\DoxyCodeLine{31         \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{32 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{33     \}}
\DoxyCodeLine{34     }
\DoxyCodeLine{36     \textcolor{keywordtype}{bool} \mbox{\hyperlink{class_embeddings_calculator_a786685456a4080394f315a378aeada39}{IsInitialized}}()\textcolor{keyword}{ const}}
\DoxyCodeLine{37 \textcolor{keyword}{    }\{}
\DoxyCodeLine{38 \textcolor{preprocessor}{\#ifdef USE\_OCV\_EMBEDDINGS}}
\DoxyCodeLine{39         \textcolor{keywordflow}{return} !m\_net.empty();}
\DoxyCodeLine{40 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{41         \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{42 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{43     \}}
\DoxyCodeLine{44 }
\DoxyCodeLine{46     \textcolor{keywordtype}{void} \mbox{\hyperlink{class_embeddings_calculator_a5ad6146768c431735a4d65d72c149bdd}{Calc}}(\textcolor{keyword}{const} cv::UMat\& img, cv::Rect rect, cv::Mat\& embedding)}
\DoxyCodeLine{47     \{}
\DoxyCodeLine{48 \textcolor{preprocessor}{\#ifdef USE\_OCV\_EMBEDDINGS}}
\DoxyCodeLine{49         \textcolor{keyword}{auto} Clamp = [](\textcolor{keywordtype}{int}\& v, \textcolor{keywordtype}{int}\& size, \textcolor{keywordtype}{int} hi) -\/> \textcolor{keywordtype}{int}}
\DoxyCodeLine{50         \{}
\DoxyCodeLine{51             \textcolor{keywordtype}{int} res = 0;}
\DoxyCodeLine{52             \textcolor{keywordflow}{if} (v < 0)}
\DoxyCodeLine{53             \{}
\DoxyCodeLine{54                 res = v;}
\DoxyCodeLine{55                 v = 0;}
\DoxyCodeLine{56                 \textcolor{keywordflow}{return} res;}
\DoxyCodeLine{57             \}}
\DoxyCodeLine{58             \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (v + size > hi -\/ 1)}
\DoxyCodeLine{59             \{}
\DoxyCodeLine{60                 res = v;}
\DoxyCodeLine{61                 v = hi -\/ 1 -\/ size;}
\DoxyCodeLine{62                 \textcolor{keywordflow}{if} (v < 0)}
\DoxyCodeLine{63                 \{}
\DoxyCodeLine{64                     size += v;}
\DoxyCodeLine{65                     v = 0;}
\DoxyCodeLine{66                 \}}
\DoxyCodeLine{67                 res -\/= v;}
\DoxyCodeLine{68                 \textcolor{keywordflow}{return} res;}
\DoxyCodeLine{69             \}}
\DoxyCodeLine{70             \textcolor{keywordflow}{return} res;}
\DoxyCodeLine{71         \};}
\DoxyCodeLine{72         Clamp(rect.x, rect.width, img.cols);}
\DoxyCodeLine{73         Clamp(rect.y, rect.height, img.rows);}
\DoxyCodeLine{74 }
\DoxyCodeLine{75         cv::UMat obj;}
\DoxyCodeLine{76         cv::resize(img(rect), obj, m\_inputLayer, 0., 0., cv::INTER\_LANCZOS4);}
\DoxyCodeLine{77         cv::Mat blob = cv::dnn::blobFromImage(obj, 1.0, cv::Size(), cv::Scalar(), \textcolor{keyword}{false}, \textcolor{keyword}{false});}
\DoxyCodeLine{78         }
\DoxyCodeLine{79         m\_net.setInput(blob);}
\DoxyCodeLine{80         embedding = m\_net.forward();}
\DoxyCodeLine{81         \textcolor{comment}{//std::cout << "{}embedding: "{} << embedding.size() << "{}, chans = "{} << embedding.channels() << std::endl;}}
\DoxyCodeLine{82 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{83         std::cerr << \textcolor{stringliteral}{"{}EmbeddingsCalculator was disabled in CMAKE! Check SetDistances params."{}} << std::endl;}
\DoxyCodeLine{84 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{85     \}}
\DoxyCodeLine{86 }
\DoxyCodeLine{87 \textcolor{keyword}{private}:}
\DoxyCodeLine{88 \textcolor{preprocessor}{\#ifdef USE\_OCV\_EMBEDDINGS}}
\DoxyCodeLine{89     cv::dnn::Net m\_net;}
\DoxyCodeLine{90     cv::Size m\_inputLayer\{ 128, 256 \};}
\DoxyCodeLine{91 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{92 \};}

\end{DoxyCode}
